From 6019245a5452cf34f3bc11132bc91b16422175b7 Mon Sep 17 00:00:00 2001
From: "Uwe L. Korn" <uwe.korn@quantco.com>
Date: Wed, 30 Aug 2023 16:58:41 +0200
Subject: [PATCH 04/29] Fix protobuf_python for systemlibs

---
 tensorflow/workspace2.bzl                     |  2 ++
 .../0001-Add-Python-include-path.patch        | 23 +++++++++++++++++++
 third_party/systemlibs/protobuf_python.bzl    |  5 ++++
 3 files changed, 30 insertions(+)
 create mode 100644 third_party/pybind11_protobuf/0001-Add-Python-include-path.patch
 create mode 100644 third_party/systemlibs/protobuf_python.bzl

diff --git a/tensorflow/workspace2.bzl b/tensorflow/workspace2.bzl
index 5d75ffd4a6d..e985a71b74e 100644
--- a/tensorflow/workspace2.bzl
+++ b/tensorflow/workspace2.bzl
@@ -401,6 +401,7 @@ def _tf_repositories():
         system_link_files = {
             "//third_party/systemlibs:protobuf.bzl": "protobuf.bzl",
             "//third_party/systemlibs:protobuf_deps.bzl": "protobuf_deps.bzl",
+            "//third_party/systemlibs:protobuf_python.bzl": "python/BUILD",
         },
         urls = tf_mirror_urls("https://github.com/protocolbuffers/protobuf/archive/v3.21.9.zip"),
     )
@@ -792,6 +793,8 @@ def _tf_repositories():
         strip_prefix = "pybind11_protobuf-80f3440cd8fee124e077e2e47a8a17b78b451363",
         patch_file = [
             "//third_party/pybind11_protobuf:remove_license.patch",
+            "//third_party/pybind11_protobuf:0001-DO-not-link-to-proto_api.patch",
+            "//third_party/pybind11_protobuf:0002-Add-Python-include-path.patch",
         ],
     )
 
