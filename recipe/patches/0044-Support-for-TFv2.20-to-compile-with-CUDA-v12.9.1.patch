From 6f35d3d6c40cbf09dd848d37b9911e0d8725aa35 Mon Sep 17 00:00:00 2001
From: aravindhbalaji1985 <aravindhbalaji@gmail.com>
Date: Mon, 25 Aug 2025 15:15:14 -0700
Subject: [PATCH 44/44] Support for TFv2.20 to compile with CUDA v12.9.1

---
 tensorflow/core/kernels/dynamic_partition_op_gpu.cu.cc |  4 ++++
 tensorflow/core/kernels/where_op_gpu.cu.h              | 10 ++++++++++
 2 files changed, 14 insertions(+)

diff --git a/tensorflow/core/kernels/dynamic_partition_op_gpu.cu.cc b/tensorflow/core/kernels/dynamic_partition_op_gpu.cu.cc
index ae3fe6d140f..cb603ba7c6c 100644
--- a/tensorflow/core/kernels/dynamic_partition_op_gpu.cu.cc
+++ b/tensorflow/core/kernels/dynamic_partition_op_gpu.cu.cc
@@ -410,7 +410,11 @@ class DynamicPartitionOpGPU : public AsyncOpKernel {
                                             num_partitions_);
 
 #if GOOGLE_CUDA
+#if THRUST_VERSION >= 200802
+    thrust::constant_iterator<int32> values_in(1);
+#else
     cub::ConstantInputIterator<int32> values_in(1);
+#endif
 #elif TENSORFLOW_USE_ROCM
     using ConstantInputIterator =
         ::rocprim::constant_iterator<int32, ptrdiff_t>;
diff --git a/tensorflow/core/kernels/where_op_gpu.cu.h b/tensorflow/core/kernels/where_op_gpu.cu.h
index 5eb03ec60ad..949e183b466 100644
--- a/tensorflow/core/kernels/where_op_gpu.cu.h
+++ b/tensorflow/core/kernels/where_op_gpu.cu.h
@@ -233,6 +233,16 @@ class WhereOutputIterator {
     return *(ptr_ + (valid ? (NDIM * n) : 0));
   }
 
+  EIGEN_DEVICE_FUNC EIGEN_STRONG_INLINE reference operator*() const {
+    // Dereference the current pointer
+    return *ptr_;
+  }
+
+  EIGEN_DEVICE_FUNC EIGEN_STRONG_INLINE self_type
+  operator+(std::ptrdiff_t n) const {
+    return self_type(ptr_ + NDIM * n, max_row_);
+  }
+
  private:
   int64* ptr_;
   const Eigen::DenseIndex max_row_;
