From 8d2c24e994b69f63ad4542407b2d0da7136a65dd Mon Sep 17 00:00:00 2001
From: "Uwe L. Korn" <uwe.korn@quantco.com>
Date: Tue, 31 May 2022 14:24:49 +0200
Subject: [PATCH] Use pre-built LLVM

---
 tensorflow/workspace2.bzl | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/tensorflow/workspace2.bzl b/tensorflow/workspace2.bzl
index 0738a9f9..9dd72d5e 100644
--- a/tensorflow/workspace2.bzl
+++ b/tensorflow/workspace2.bzl
@@ -14,7 +14,6 @@ load("@tf_toolchains//toolchains/embedded/arm-linux:arm_linux_toolchain_configur
 load("//third_party:repo.bzl", "tf_http_archive", "tf_mirror_urls")
 load("//third_party/clang_toolchain:cc_configure_clang.bzl", "cc_download_clang_toolchain")
 load("//tensorflow/tools/def_file_filter:def_file_filter_configure.bzl", "def_file_filter_configure")
-load("//third_party/llvm:setup.bzl", "llvm_setup")
 
 # Import third party repository rules. See go/tfbr-thirdparty.
 load("//third_party/FP16:workspace.bzl", FP16 = "repo")
@@ -52,6 +51,7 @@ load("@tf_toolchains//toolchains/remote_config:configs.bzl", "initialize_rbe_con
 load("@tf_toolchains//toolchains/remote:configure.bzl", "remote_execution_configure")
 load("@tf_toolchains//toolchains/clang6:repo.bzl", "clang6_configure")
 load("@rules_pkg//:deps.bzl", "rules_pkg_dependencies")
+load("@llvm-raw//utils/bazel:configure.bzl", "llvm_disable_optional_support_deps")
 
 def _initialize_third_party():
     """ Load third party repositories.  See above load() statements. """
@@ -524,7 +524,12 @@ def _tf_repositories():
         urls = tf_mirror_urls("https://github.com/antirez/linenoise/archive/c894b9e59f02203dbe4e2be657572cf88c4230c3.tar.gz"),
     )
 
-    llvm_setup(name = "llvm-project")
+    llvm_disable_optional_support_deps()
+    native.new_local_repository(
+        name = "llvm-project",
+        path = "llvm-project",
+        build_file_content = "# empty",
+    )
 
     # Intel openMP that is part of LLVM sources.
     tf_http_archive(
-- 
2.32.1 (Apple Git-133)

